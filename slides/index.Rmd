---
title: "Presentation Ninja"
subtitle: "&#x2694;&#xFE0F; xaringan +<br/>&#x1F60E; xaringanthemer"  
author: 
  - "Yihui Xie"
  - "Garrick Aden-Buie"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: ["xaringan-themer.css", "custom.css"]
    nature:
      slideNumberFormat: "%current%/%total%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width = 9, fig.height = 3.5, fig.retina = 3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
# xaringanthemer::style_duo_accent(
#   primary_color = "#1381B0",
#   secondary_color = "#FF961C",
#   inverse_header_color = "#FFFFFF"
# )
xaringanthemer::style_duo_accent(
  primary_color = "#005c8b",
  secondary_color = "#0073ae",
  inverse_header_color = "#FFFFFF"
)
```

```{r xaringanExtra, echo=FALSE}
#devtools::install_github("gadenbuie/xaringanExtra")
# xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))

xaringanExtra::use_clipboard()
xaringanExtra::use_fit_screen()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
xaringanExtra::use_share_again()
xaringanExtra::use_scribble()
xaringanExtra::use_tile_view()
xaringanExtra::use_tachyons()
xaringanExtra::use_panelset()
```

# Sum√°rio

1. [R e RStudio](#r-rstudio)
2. [Introdu√ß√£o](#introducao)
3. [Projetos](#projetos)
4. [Importa√ß√£o de dados](#importacao)
5. [Manipula√ß√£o de dados](#manipulacao)

---

class: inverse center middle
name: r-rstudio

# R e RStudio 

---

## Instala√ß√£o do R

.pull-left[
<br>
<br>
<br>
<br>
<br>
- [Download](https://cran.r-project.org/)
- Use a vers√£o mais recente `r emo::ji("wink")` 
]
.pull-right[
<br>
<br>
<br>
```{r, fig.align='center', out.width='60%', echo=FALSE}
knitr::include_graphics("img/01-r-logo.svg")
```
]

---

## Instala√ß√£o do R

```{r, fig.align='center', out.width="80%", echo=FALSE}
knitr::include_graphics("img/02-r-install.png")
```

---

## Instala√ß√£o do RStudio

.pull-left[
<br>
<br>
<br>
<br>
<br>
- [Download](https://posit.co/download/rstudio-desktop/)
- Use a vers√£o mais recente `r emo::ji("wink")` 
]
.pull-right[
<br>
<br>
<br>
<br>
<br>
```{r, fig.align='center', out.width="70%", echo=FALSE}
knitr::include_graphics("img/03-rstudio.png")
```
]

---

## Instala√ß√£o do RStudio

```{r, fig.align='center', out.width="80%", echo=FALSE}
knitr::include_graphics("img/04-rstudio-install.png")
```

---

### O que √© o R?

> "R √© um ambiente de software livre para computa√ß√£o estat√≠stica e gr√°ficos." [R Development Core Team](https://cran.r-project.org/)

  - **Por que usar o R?**
  
    - √â uma linguagem de programa√ß√£o que possui muitas ferramentar para a an√°lise de dados;
    
    - √â em c√≥digo aberto e gratuito (*open source*);
    
    - Possui uma comunidade ativa de pessoas desenvolvedoras;
    
    - √â flex√≠vel, permite desenvolver fun√ß√µes e pacotes para facilitar o trabalho;
    
    - Est√° dispon√≠vel gratuitamente em diferentes plataformas: Linux, MacOS e Windows;
    
    - Mantido pela [R Development Core Team](https://cran.r-project.org/).
    
---

### RStudio

**RStudio** √© uma IDE (*Integrated Development Environment*) da Linguagem R, isto √©, um ambiente de desenvolvimento utilizado para editar e executar c√≥digos em R. Ela √© mantida pela [Posit](https://posit.co).

```{r, fig.align='center', out.width="80%", echo=FALSE}
knitr::include_graphics("img/05-rstudio.png")
```

---

### RStudio

**Editor/Scripts:** onde os c√≥digos s√£o escritos. O **RStudio** destaca algumas palavras e s√≠mbolos para facilitar a leitura do c√≥digo.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/06-rstudio-haydee.jpg")
```

---

### RStudio

**Console:** onde os c√≥digos s√£o executados e os resultados s√£o exibidos. **O R vive aqui!**

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/07-rstudio-haydee.jpg")
```

---

### RStudio

**Environment:** painel com todos os objetos criados na sess√£o.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/08-rstudio-haydee.jpg")
```

---

### RStudio

**History:** painel com um hist√≥rico dos comandos rodados.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/09-rstudio-haydee.jpg")
```

---

### RStudio

**Files:** mostra os arquivos no diret√≥rio de trabalho. √â poss√≠vel navegar entre os diret√≥rios.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/10-rstudio-haydee.jpg")
```

---

### RStudio

**Plots:** painel onde os gr√°ficos ser√£o apresentados.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/11-rstudio-haydee.jpg")
```

---

### RStudio

**Packages:** apresenta todos os pacotes instalados e carregados.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/12-rstudio-haydee.jpg")
```

---

### RStudio

**Help:** janela onde a documenta√ß√£o das fun√ß√µes ser√£o apresentadas.

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/13-rstudio-haydee.jpg")
```

---

### Atalhos

Conhecer os atalhos do teclado ajuda bastante durante a programa√ß√£o no **RStudio**.

- **CTRL + ENTER:** avalia/roda a linha selecionada no script;

- **ALT + ‚Äì:** cria um sinal de atribui√ß√£o (`<-`);

- **CTRL + SHIFT + M:** adiciona o operador pipe (`%>%` ou `|>`);

- **CTRL + SHIFT + C:** comenta a(s) linha(s) selecionada(s);

- **CTRL + SHIFT + D:** duplica a(s) linha(s) selecionada(s);

- **CTRL + 1:** altera o cursos para o script;

- **CTRL + 2:** altera o cursos para o console;

- **ALT + SHIFT + K:** mostra uma janela com todos os atalhos dispon√≠veis.

<br>

No MacOS, substitua **CTRL** por **CMD** e **ALT** por **OPT**.

---

### Help! 

Ficou com d√∫vida sobre determinado pacote ou fun√ß√£o?

  - Pe√ßa ajuda: **help**(nome_do_pacote) ou **?**nome_do_pacote;
  
  - Pe√ßa ajuda: **help**(nome_da_funcaoo) ou **?**nome_da_funcao;
  
<br>
  
```{r, eval=FALSE}
help(sum)
?sum
```

<br>

  - Se a d√∫vida persistir, procure no [Google](https://www.google.com/) ou no [Stack Overflow](https://stackoverflow.com/).
  
  - E se ainda estiver com d√∫vidas, pergunte para a comunidade:
  
    - h√° diversos grupos de Telegram, Twitter, Discourse e em outras redes sociais.

---

### [Cheat Sheets](https://rstudio.com/resources/cheatsheets/)

O **RStudio** disponibiliza algumas 'folhas de cola', as **Cheat Sheets**. Elas trazem um resumo de como utilizar diversos pacotes e at√© o pr√≥prio RStudio. Para acess√°-las, basta clicar no menu `Help` e ent√£o em `Cheat Sheets`, ou atrav√©s do site da [**Posit**](https://posit.co/resources/cheatsheets/).

[![Cheat Sheets](img/14-cheatsheet-rstudio.png)](https://rstudio.github.io/cheatsheets/rstudio-ide.pdf)

---

### O Ciclo da Ci√™ncia de Dados

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/15-ciclo-ciencia-de-dados.png")
```

---

### O Ciclo da Ci√™ncia de Dados no R

```{r, fig.align='center', out.width="700px", echo=FALSE}
knitr::include_graphics("img/16-ciclo-ciencia-de-dados-no-r.png")
```

---

class: inverse center middle
name: introducao

# Introdu√ß√£o

.center[(Acompanhe no arquivo `01-introducao.R`)]

---

### R como calculadora

O **R** permite realizar muitas opera√ß√µes matem√°ticas!

```{r}
2 + 5 # adi√ß√£o

9 - 4 # subtra√ß√£o

5 * 2 # multiplica√ß√£o

7 / 5 # divis√£o
```

- **CTRL + ENTER:** executa a linha selecionada no script

---

### R como calculadora

```{r}
9 %% 4 # resto da divis√£o de 9 por 4

7 %/% 4 # parte inteira da divis√£o de 7 por 4

8 ^ 2 # potencia√ß√£o

sqrt(1024) # radicia√ß√£o
```

A ordem matem√°tica das opera√ß√µes tamb√©m vale do R.

---

### Fun√ß√µes matem√°ticas

```{r}
sin(1) # fun√ß√µes trigonom√©tricas

log(1) # logaritmo natural (base e)

log10(10) # logaritmo na base 10

exp(0.5) # exponencial e^(1/2)
```

---

### Objetos

O **R** permite armazenar (salvar) valores dentro de um objeto.

Um **objeto** √© um nome que guarda um valor, uma fun√ß√£o ou uma base de dados.

- Para atribuir um valor a um objeto no R, utilizamos o operador `<-`.

.center[`nome_do_objeto <- valor`]

- Atalho: **ALT** + **‚Äì**: cria o `<-` sinal de atribui√ß√£o.

---

#### Exemplo:

```{r}
nome <- "Fernando Oliveira Costa"
nome

idade <- 40
idade

cargo_ou_funcao <- "Gerente de Projetos"
cargo_ou_funcao

salario <- 12000.00
salario
```

---

### Nomes dos Objetos

Existem algumas regras para dar nomes aos objetos:

- os nomes devem come√ßar com uma letra. E podem conter letras, n√∫meros, `_` e `.`. N√£o usar acentua√ß√µes e/ou espa√ßos! O autor do livro [R for Data Science](https://r4ds.hadley.nz) recomenda usar **snake_case**, ou seja, palavras escritas em min√∫sculo separadas por underline (`_`).

- o R √© **case sensitive**, isto √©, faz a diferencia√ß√£o entre as letras min√∫sculas e mai√∫sculas. Portanto, um objeto chamado `teste` √© diferente de outro objeto chamado `Teste`.

```{r}
a <- 2
a

A <- 4
A
```

---

### Operadores Relacionais

- Igual a: **==**

- Diferente de: **!=**

- Maior que: **>**

- Maior ou igual a: **>=**

- Menor que: **<**

- Menor ou igual a: **<=**

---

### Operadores Relacionais

- Igual a: **==**

```{r}
TRUE == TRUE

TRUE == FALSE
```

- Diferente de: **!=**

```{r}
TRUE != TRUE

TRUE != FALSE
```

---

### Operadores Relacionais

- Maior que: **>**

```{r}
15 > 10

10 > 10
```

- Menor que: **<**

```{r}
3 < 5

10 < 5
```

---

### Operadores Relacionais

- Maior ou igual a: **>=**

```{r}
15 >= 10

15 >= 15
```

- Menor ou igual a: **<=**

```{r}
10 <= 10

10 <= 8
```

---

### Operadores L√≥gicos

- AND - E: **&**

Ser√° verdadeiro (`TRUE`) se as duas condi√ß√µes forem verdadeiras

```{r}
x <- 15

  x > 10 & x <= 20
  
y <- 7

  y > 10 & y <= 15
```

---

### Operadores L√≥gicos

- OR - OU: **|**

Ser√° verdadeiro (`TRUE`) se uma das duas condi√ß√µes for verdadeira

```{r}
x <- 5

  x >= 10 | x <= 15
  
y <- 2

  y >= 5 | y == 0
```

---

### Operadores L√≥gicos

- NOT - NEGA√á√ÉO: **!**

```{r}
!TRUE

!FALSE

x <- c(TRUE, FALSE, TRUE, FALSE)

  !x

y <- 8

  (!y < 5)
```

---

### Pertence

√â poss√≠vel verificar se um valor est√° inserido dentro de um conjunto de valores (vetor).

√â representado pelo operador **%in%**.

```{r}
3 %in% c(1, 2, 3, 4, 5)

3 %in% c(4, 5, 6)

"a" %in% c("a", "b")

"a" %in% c("c", "d", "e")
```

---

### Tipos B√°sicos de dados

S√£o os tipos de dados que podem ser representados na Linguagem R. √â neles que s√£o guardadas as informa√ß√µes.

- **Integer:** n√∫meros inteiros

- **Double/Numeric:** n√∫meros racionais

- **Logical:** tipos l√≥gicos (`TRUE` ou `FALSE`)

- **Character:** texto (sempre entre aspas)

- **Factor:** dados categ√≥ricos

<br>

A fun√ß√£o `class()` retorna o tipo de dado de um objeto.

---

### N√∫meros

Um n√∫mero inteiro seguido de `L` ser√° considerado do tipo **integer**:

```{r}
class(5L)
```

<br>

N√∫meros racionais ser√£o considerados do tipo **double/numeric**:

```{r}
class(5)

class(5.1)
```

---

### L√≥gicos

Verdadeiro (`TRUE`) e Falso (`FALSE`) 

```{r}
class(TRUE)

class(FALSE)
```

<br>

O R entende o `TRUE` sendo igual a 1 (um) e o `FALSE` sendo igual a 0 (zero).

Isso significa que √© poss√≠vel realizar opera√ß√µes matem√°ticas com ele (por exemplo, somar):

```{r}
TRUE + FALSE + FALSE + TRUE + TRUE + TRUE + FALSE
```

---

### Textos

**Qualquer** c√≥digo entre aspas (`""`) ser√° interpretado como texto **character**:

```{r}
class("TEXTO")

ensino <- c("M√©dio", "Superior", "Fundamental", "Fundamental", "M√©dio")

class(ensino)

class("3")
```

---

### Fatores

Os fatores (ou factors) s√£o usados para representar categorias.

```{r}
# Criando um factor

ensino_categorias <- factor(c("M√©dio", "Superior", "Fundamental", "Fundamental", "M√©dio"))

ensino_categorias

class(ensino_categorias)
```

<br>

A fun√ß√£o `as.factor()` cria um objeto do tipo `factor` ou converte um objeto j√° existente.

Na linha `levels` aparecem os r√≥tupos do fator.

---

### NA

**NA** representa um valor desconhecido ou ausente. As opera√ß√µes envolvendo um valor desconhecido tamb√©m resultar√£o em valores desconhecidos (`NA`).

```{r}
NA > 10

NA + 10

NA / 5

10 == NA
```

---

### NA

```{r}
NA == NA
```

<br>
<br>

`is.na()` √© a fun√ß√£o que verifica se um objeto √© `NA`.

```{r}
vetor_numerico <- c(NA, 1, 2, 3, 4, 5, NA)

is.na(vetor_numerico)

!is.na(vetor_numerico)
```

---

### na.rm = TRUE

Quando um vetor cont√©m valores ausentes (`NA`), muitas fun√ß√µes n√£o conseguem realizar os c√°lculos corretamente e retornam `NA` como resultado. Na maioria dos casos, o que se deseja √© calcular o resultado ignorando os valores ausentes. Para isso, utiliza-se o argumento `na.rm = TRUE`, que instrui a fun√ß√£o a remover os `NAs` antes de calcular.

```{r}
sum(vetor_numerico)

sum(vetor_numerico, na.rm = TRUE)

mean(vetor_numerico)

mean(vetor_numerico, na.rm = TRUE)
```

---

### Convers√£o de classes

```{r}
vetor_logical <- c(TRUE, TRUE, FALSE, TRUE, FALSE)

as.integer(vetor_logical) # converte para n√∫mero inteiro

as.numeric(vetor_logical) # converte para n√∫mero racional

as.character(vetor_logical) # converte para texto

as.factor(vetor_logical) # converte para fator
```

---

### Convers√£o de classes

```{r}
frutas <- c("amora", "banana", "melancia")

as.integer(frutas)

as.numeric(frutas)

as.character(frutas)

as.factor(frutas)
```

---

### Tipos de Objetos

No **R**, os quatro principais objetos s√£o:

- Vetor;

- Matriz;

- Lista;

- Data Frame.

---

### Vetores

Armazenam elementos de uma **mesma classe** em apenas **uma dimens√£o**.

Para cri√°-los, basta passar os valores, separados por v√≠rgulas, para a fun√ß√£o `c()`.

<br>

```{r}
primeiro_semestre <- c("Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho")

primeiro_semestre

# retorna o comprimento do vetor ‚Äî quantos elementos ele tem?

length(primeiro_semestre)
```

---

### Vetores

Para criar um vetor com uma sequ√™ncia de n√∫meros, basta utilizar o operador **:**

```{r}
# vetor de 1 a 10

1:10

# vetor de 10 a 1

10:1

# betor de -5 a 5

-5:5
```

---

### Vetores

Por serem conjuntos indexados, cada valor dentro de um vetor tem uma posi√ß√£o. Essa posi√ß√£o √© dada pela ordem em que os elementos foram dispostos no momento em que o vetor √© criado. Dessa forma, √© poss√≠vel acessar individualmente cada valor de um vetor.

Para isso, basta colocar o √≠ndice do valor que se deseja acessar dentro de **colchetes** `[]`:

```{r}
# primeiro elemento do vetor

primeiro_semestre[1]

# primeiro e segundo elemento do vetor

primeiro_semestre[1:2]
```

---

### Vetores

```{r}
# remove o primeiro elemento do vetor

primeiro_semestre[-1]

# seleciona o elemento seis at√© o quatro (e muda a ordem dos elementos)

primeiro_semestre[6:4]
```

√â poss√≠vel colocar um conjunto de √≠ndices dentro dos colchetes para pegar os valores contidos nessas posi√ß√µes:

```{r}
# seleciona o primeiro, o terceiro e o quinto elemento do vetor

primeiro_semestre[c(1, 3, 5)]
```

Essas opera√ß√µes s√£o chamadas de **subsetting**, pois s√£o acessados os subconjuntos de valores de um vetor.

---

### Vetores

**Classe do Vetor:**

Um vetor s√≥ pode guardar um tipo de objeto e ele ter√° sempre a mesma classe dos objetos que guarda.

Para saber a classe de um vetor, basta usar a fun√ß√£o `class(nome_do_vetor)`.

<br>

```{r}
primeiro_semestre <- c("Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho")

class(primeiro_semestre)

anos_bissextos <- c(2000, 2004, 2008, 2012, 2016, 2020, 2024)

class(anos_bissextos)
```

---

### Vetores

**Coer√ß√£o:**

Ao tentar misturar duas classes de elementos dentro de um vetor, o **R** vai apresentar o comportamento conhecido como **coer√ß√£o**.

```{r}
segundo_semestre <- c(7, 8, 9, 10, 11, "Dezembro")

segundo_semestre

class(segundo_semestre)
```

Todos os elementos do vetor se transformaram em **texto**. Como um vetor s√≥ pode ter uma classe de objeto dentro dele, classes mais fracas ser√£o sempre reprimidas pelas classes mais fortes.

.center[`character > numeric > integer > logical`]

---

### Vetores

**Opera√ß√µes com Vetores:**

√â poss√≠vel realizar opera√ß√µes aritm√©ticas com vetores:

```{r}
vetor_numerico <- c(0, 5, 10, 15, 20)

vetor_numerico + 1
```

Ao rodar `vetor_numerico + 1`, o **R** adiciona 1 de cada um dos elementos do vetor. O mesmo acontece com qualquer outra opera√ß√£o aritm√©tica.

```{r}
vetor_numerico * 2 # multiplica todos os elementos do vetor por 2

vetor_numerico - 1 # subtrai todos os elementos do vetor por 1
```

---

### Vetores

**Vetoriza√ß√£o:**

Tamb√©m √© poss√≠vel fazer opera√ß√µes que envolvem mais de um vetor:

```{r}
vetor1 <- c(1, 2, 3)

vetor2 <- c(10, 20, 30)

vetor1 + vetor2
```

<br>

O **R** vai alinhar os dois vetores e somar os elementos que est√£o na mesma posi√ß√£o.

---

### Vetores

**Reciclagem:**

Ocorre quando os dois vetores n√£o possuem o mesmo tamanho:

```{r}
vetor1 <- c(1, 2)

vetor2 <- c(10, 20, 30, 40)

vetor1 + vetor2
```

<br>

O **R** alinhou os dois vetores e, como eles n√£o possuem o mesmo tamanho, os elementos do `vetor1` foram repetidos para ficar do mesmo tamanho do `vetor2`. √â como se o primeiro vetor fosse `c(1, 2, 1, 2)`.

---

### Vetores 

**Reciclagem:**

Um caso interessante ocorre quando o comprimento dos vetores n√£o s√£o m√∫ltiplos um do outro:

```{r warning=TRUE, message=TRUE}
vetor1 <- c(1, 2, 3)

vetor2 <- c(10, 20, 30, 40, 50)

vetor1 + vetor2
```

O **R** realizou a opera√ß√£o, repetindo cada valor do primeiro vetor at√© que os dois tivessem o mesmo tamanho. Na realidade, a opera√ß√£o realizada foi `c(1, 2, 3, 1, 2) + c(10, 20, 30, 40, 50)`.

Como essa opera√ß√£o n√£o √© intuitiva, o **R** devolveu um aviso dizendo que o comprimento do primeiro vetor n√£o √© m√∫ltiplo do comprimento do segundo vetor.

---

### Vetores

**Filtro:**

```{r}
numeros <- c(-3, -1, 3, 5, 7, 10, 15)
numeros > 3
```

Na primeira opera√ß√£o, o **R** fez uso da **Reciclagem**. Ele transformou o valor 3 em um vetor `c(3, 3, 3, 3, 3, 3, 3)` e testou (comparou) se `c(-3, -1, 3, 5, 7, 10, 15) > c(3, 3, 3, 3, 3, 3, 3)`.

```{r}
numeros[numeros > 3]
```

A segunda opera√ß√£o retornou as posi√ß√µes que receberam `TRUE` e n√£o retornou os valores que receberam `FALSE`. Portanto, a segunda opera√ß√£o √© equivalente a:

```{r}
numeros[c(FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)]
```

---

### Matrizes

S√£o estruturas que correspondem √†s matrizes matem√°ticas, conjuntos bidimensionais contendo elementos dispostos em linhas e colunas. Assim como os vetores, todos os seus elementos s√£o do mesmo tipo. S√£o criadas utilizando a fun√ß√£o `matrix()`:

```{r}
matriz1 <- matrix(c(1:12), nrow = 3, ncol = 4)

matriz1

class(matriz1)

dim(matriz1)
```

---

### Matrizes

√â poss√≠vel alterar a ordem de preenchimento da matriz (linhas ao inv√©s de colunas)

```{r}
matriz2 <- matrix(c(1:12), nrow = 3, ncol = 4, byrow = TRUE)

matriz2

class(matriz2)

dim(matriz2)
```

---

### Matrizes

Tamb√©m √© poss√≠vel adicionar colunas com `cbind()` e linhas com `rbind()`

```{r}
cbind(matriz1, rep(99, 3))

rbind(matriz1, rep(99, 4))
```

---

### Matrizes

**Opera√ß√µes com Matrizes:**

```{r}
# multiplica cada elemento da matriz por 2 (multiplica√ß√£o escalar)

matriz1 * 2 

# retorna o resto da divis√£o de cada elemento da matriz1 pelo correspondente em matriz2

matriz1 %% matriz2 
```

---

### Listas

S√£o um tipo especial de vetor que podem conter uma **cole√ß√£o de diferentes classes**. Possuem uma **estrutura unidimensional**, contando apenas o n√∫mero de elementos integrantes. S√£o criados usando a fun√ß√£o `list()`

```{r}
lista <- list(a = 1:10, b = c("T1", "T2", "T3", "T4"), TRUE, 2 + 2)

lista
```

- Os dois primeiros elementos t√™m nomes (`$a` e `$b`), enquanto os dois √∫ltimos s√£o acessados por √≠ndices (`[[3]]` e `[[4]]`) pois n√£o foram nomeados.

---

### Listas

```{r}
class(lista)
```

- A estrutura √© realmente uma **lista**.

```{r}
dim(lista)
```

- O resultado **NULL** √© esperado pois as listas no R n√£o t√™m "dimens√µes" como vetores ou matrizes. Elas s√£o estruturas mais gerais.

```{r}
length(lista)
```

- A lista apresenta 4 elementos, mesmo que alguns deles contenham vetores maiores por dentro.

---

## Data Frame

S√£o tabelas **bidimensionais** (linhas e colunas), em que cada coluna pode ser de uma classe diferente. S√£o criados com a fun√ß√£o `data.frame()`:

```{r, echo=FALSE}
mtcars |> 
  head(n = 10) |> 
  knitr::kable()
```

---

### Data Frame

```{r}
# retorna a classe
class(mtcars)

# retorna o n√∫mero de colunas
ncol(mtcars)

# retorna o n√∫mero de linhas
nrow(mtcars)

# retorna a dimens√£o do dataframe ‚Äî o n√∫mero de linhas e de colunas
dim(mtcars)
```

---

### Data Frame

```{r}
# retorna a estrutura interna do objeto mtcars, como: tipo do objeto, 
# n√∫mero de observa√ß√µes (linhas) e vari√°veis (colunas), nome de cada vari√°vel, 
# tipo (classe) de cada vari√°vel e os primeiros valores de cada vari√°vel

str(mtcars)
```

---

### Data Frame

```{r}
# retorna as seis primeiras linhas de uma tabela
head(mtcars)

# retorna as seis √∫ltimas linhas de uma tabela
tail(mtcars)
```

---

### Data Frame

**Selecionando as Colunas:**

Para selecionar as colunas de um dataframe, utilizamos o operador `$`:

.bg-lightest-blue.b-dark-blue.bw2.br3.ph4.mt2.-m[
üìå &nbsp;&nbsp;&nbsp;&nbsp; **Dica:** ap√≥s escrever o `nome_do_dataframe$`, pressione a tecla `TAB` para ver as colunas dispon√≠veis.
]

```{r}
mtcars$cyl

mtcars$gear

mtcars$mpg
```

---

### Data Frame

**Subsetting:**

Seleciona **elemento(s)** de um `data.frame` usando colchetes `[]`:&nbsp;&nbsp;&nbsp;&nbsp;`data_frame[linha, coluna]`

```{r}
# retorna o elemento presente na segunda linha da terceira coluna
mtcars[2, 3]

# retorna todas as linhas da coluna 1
mtcars[, 1]

# retorna todas as colunas da linha 1
mtcars[1, ]
```

---

### Data Frame

**Subsetting:** 

Sele√ß√£o de **m√∫ltiplas colunas** de um `data.frame`:&nbsp;&nbsp;&nbsp;&nbsp;`data_frame[, c(coluna1, coluna2, ..., colunaN)]`

H√° duas formas de fazer isso:

.pull-left[
```{r}
mtcars[, c(1, 2, 4)]
```
]

.pull-right[
```{r}
mtcars[, c("mpg", "cyl", "hp")]
```
]

---

### Data Frame

**Filtrando colunas:**

.panelset[

.panel[.panel-name[Exemplo 1]
```{r}
# seleciona apenas as linhas onde a coluna mpg √© exatamente igual a √© maior que 20

mtcars[mtcars$mpg > 20, ]
```
]

.panel[.panel-name[Exemplo 2]
```{r}
# seleciona apenas as linhas onde a coluna cyl '√© exatamente igual a 4

mtcars[mtcars$cyl == 4, ]
```
]

.panel[.panel-name[Exemplo 3]
```{r}
# seleciona apenas as linhas onde a coluna hp √© menor que 100

mtcars[mtcars$hp < 100, ]
```
]

]

---

### Data Frame

√â poss√≠vel aplicar fun√ß√µes diretamente nas colunas de um `data.frame`:

```{r}
# valor m√≠nimo da coluna mpg
min(mtcars$mpg)

# valor m√°ximo da coluna mpg
max(mtcars$mpg)

# valor m√©dio da coluna mpg
mean(mtcars$mpg)

# valor da mediana da coluna mpg
median(mtcars$mpg)
```

---

### Fun√ß√µes

Enquanto os objetos s√£o nomes que armazenam valores, as **fun√ß√µes** s√£o nomes que armazenam um **conjunto de instru√ß√µes** em R. Sempre que uma fun√ß√£o √© executada, o c√≥digo que ela cont√©m roda automaticamente, e um resultado √© devolvido.

As fun√ß√µes permitem **automatizar tarefas** e **evitar repeti√ß√£o de c√≥digo**, de forma muito mais eficiente do que copiar e colar.

Na pr√°tica, as fun√ß√µes s√£o t√£o comuns e intuitivas que voc√™ provavelmente j√° usou v√°rias delas sem perceber. Aqui v√£o alguns exemplos que aparecem em se√ß√µes anteriores:

- `c()` ‚Äî cria vetores;

- `class()` ‚Äî mostra a classe de um objeto;

- `dim()` ‚Äî retorna as dimens√µes de um `data.frame` ou de uma `matriz`;

- `mean()` ‚Äî calcula a m√©dia de um vetor;

- `max()` ‚Äî retorna o valor m√°ximo de um vetor.

---

### Fun√ß√µes

**Estrutura de uma Fun√ß√£o:**

Uma fun√ß√£o √© composta por tr√™s partes principais:

- **Nome:** √© como ela ser√° identificada e chamada no ambiente R;

- **Argumentos:** s√£o os valores (par√¢metros) que a fun√ß√£o recebe para funcionar;

- **Corpo:** o conjunto de instru√ß√µes que ser√° executado.

<br>

```{r, eval=FALSE, include=TRUE}
# estrutura para criar uma fun√ß√£o
nome_da_funcao <- function(argumentos) {
  corpo da fun√ß√£o
}

# para usar a fun√ß√£o
nome_da_funcao(argumentos = ...)
```

---

### Fun√ß√µes

**Argumentos:**

Diferente dos objetos, as fun√ß√µes podem **receber argumentos** ‚Äî valores colocados entre par√™nteses e que s√£o usados internamente pela fun√ß√£o para executar suas tarefas.

Por exemplo, a fun√ß√£o `c()` precisa saber **quais valores formar√£o o vetor** que ela ir√° criar:

<br>

```{r}
c(1, 5, 10)
```

<br>

Nesse caso, os valores `1`, `5` e `10` s√£o os **argumentos** passados para a fun√ß√£o `c()`.

.bg-lightest-blue.b-dark-blue.bw2.br3.ph4.mt2.-m[
üìå &nbsp;&nbsp;&nbsp;&nbsp; **Dica:** os argumentos de uma fun√ß√£o s√£o sempre **separados por v√≠rgulas**.
]

---

### Fun√ß√µes

**Argumentos:**

Cada fun√ß√£o em R pode funcionar de forma diferente, mesmo quando realiza tarefas semelhantes. 

Por exemplo, a fun√ß√£o `sum()` soma os valores passados como argumentos:

```{r}
sum(1, 3)
```

Tamb√©m √© poss√≠vel passar um **vetor como argumento**, e o resultado ser√° o mesmo:

```{r}
sum(c(1, 3))
```

Ou seja, a fun√ß√£o `sum()` sabe lidar tanto com **valores separados** quanto com **vetores** como entrada.

---

### Fun√ß√µes

**Argumentos:**

Algumas fun√ß√µes exigem que os valores sejam passados de forma espec√≠fica.

A fun√ß√£o `mean()`, por exemplo, **espera um vetor como argumento** para calcular a m√©dia corretamente.

Veja a diferen√ßa:

```{r}
# s√≥ considera o primeiro n√∫mero
mean(1, 3)

# considera os dois valores dentro de um vetor
mean(c(1, 3))
```

Ou seja, ao contr√°rio de `sum()`, que aceita m√∫ltiplos argumentos separados, a `mean()` precisa receber **um √∫nico vetor** como entrada.

---

### Fun√ß√µes

**Argumentos:** 

Os argumentos de uma fun√ß√£o tamb√©m t√™m **nomes**, que podem (ou n√£o) ser usados na hora de chamar a fun√ß√£o.

Por exemplo, a fun√ß√£o `seq()` possui (entre outros) os argumentos `from`, `to` e `by`:

```{r}
seq(from = 4, to = 10, by = 2)
```

Essa chamada cria uma **sequ√™ncia num√©rica** que come√ßa em `4` (`from`), vai at√© `10` (`to`), aumentando de `2` em `2` (`by`).

Tamb√©m √© poss√∫vel usar a fun√ß√£o **sem nomear os argumentos**, desde que os valores estejam na **ordem correta**:

```{r}
seq(4, 10, 2)
```

Ou seja, usar os nomes dos argumentos torna o c√≥digo **mais leg√≠vel** ‚Äî mas n√£o √© obrigat√≥rio, se a ordem for respeitada.

---

### Fun√ß√µes

**Argumentos:** 

Quando √© **especificado o nome dos argumentos**, a ordem deles **n√£o importa**:

```{r}
seq(by = 2, to = 10, from = 4)
```

Mas, se **n√£o usar os nomes dos argumentos**, a **ordem importa**, por o R vai associar os valores na sequ√™ncia padr√£o (`from`, `to`, `by`):

```{r}
seq(2, 10, 4)
```

Ou seja:

- `r emo::ji("white_check_mark")` &nbsp;&nbsp; **com nomes:** a ordem pode ser trocada;



- `r emo::ji("x")` &nbsp;&nbsp; **sem nomes:** a ordem correta deve ser seguida para obter o resultado esperado.

---

### Fun√ß√µes

**Algumas Fun√ß√µes importantes do R base:**

<br>

| **Fun√ß√£o**   |       **O que retorna?**      | **Fun√ß√£o**   | **O que retorna?** |
|:-------------|:-----------------------------:|:------------:|:------------------:|
|   `head()`   |       6 primeiras linhas      |    `sum()`   |        soma        |
|   `tail()`   |        6 √∫ltimas linhas       |   `mean()`   |        m√©dia       |
|    `dim()`   |   n√∫mero de linhas e colunas  |  `median()`  |       mediana      |
|   `names()`  | nomes das colunas (vari√°veis) |    `var()`   |      vari√¢ncia     |
|    `str()`   |    estrutura do data frame    |    `sd()`    |    desvio-padr√£o   |
|   `cbind()`  |      acopla duas tabelas      |    `max()`   |    valor m√°ximo    |
|   `rbind()`  |      empilha duas tabelas     |    `min()`   |    valor m√≠nimo    |
|   `class()`  |        classe do objeto       |   `round()`  |  valor arredondado |

---

### Pacotes

Pacotes s√£o **cole√ß√µes de fun√ß√µes, dados e documenta√ß√£o** que estendem as funcionalidades do R base.

Para us√°-los, √© preciso primeiro **instalar** e depois **carregar** o pacote.

Um dos pacotes mais populares e poderosos do R √© o `tidyverse`, que re√∫ne diversas ferramentas para ci√™ncias de dados.

```{r, fig.align='center', echo=FALSE, out.width='400px', dpi=300}
knitr::include_graphics("img/17-icon-packages.jpg")
```

---

### Pacotes

**Instala√ß√£o dos Pacotes:**

<br>

- Via CRAN (*Comprehensive R Archive Network*):

`install.packages("nome_do_pacote")`

```{r, include=TRUE, eval=FALSE}
install.packages("tidyverse")
```

<br><br>

- Via GitHub:

`devtools::install_github("nome-do-repositorio/nome_do_pacote")`

```{r, include=TRUE, eval=FALSE}
devtools::install_github("tidyverse/dplyr")
```

---

### Pacotes

`library(nome_do_pacote)`

```{r, include=TRUE, eval=FALSE}
library(tidyverse)
```

Tamb√©m h√° outra op√ß√£o: `nome_do_pacote::nome_da_funcao()`.

```{r, include=TRUE, eval=FALSE}
dplyr::glimpse()
```

<br>

----

<br>

**Dicas sobre os Pacotes:**

1. S√≥ √© necess√°rio **instalar** um pacote **uma vez**, mas √© necess√°rio **carreg√°-lo sempre que iniciar uma nova sess√£o**.

2. Para **instalar** um pactore, use aspas: &nbsp;&nbsp; `install.packages("nome_do_pacote")`.

3. Para **carregar** um pacote, n√£o use aspas: &nbsp;&nbsp; `library(nome_do_pacote)`.

---

## Continue aprendendo!

.panelset[

.panel[.panel-name[Em Portugu√™s]
.pull-left[
- [Material da Curso-R](https://livro.curso-r.com/)

<a href="http://material.curso-r.com/">
```{r echo=FALSE, out.width="45%", fig.align='center'}
knitr::include_graphics("img/18-cursor.png")
```
</a>
]

.pull-right[
- [R para Ci√™ncia de Dados (2¬™ edi√ß√£o)](https://pt.r4ds.hadley.nz)

<a href="https://pt.r4ds.hadley.nz">
```{r echo=FALSE, out.width="55%", fig.align='center'}
knitr::include_graphics("img/19-r4ds.jpg")
```
</a>
]
]

]

---

class: inverse center middle
name: projetos

# Projetos 

---

## Projetos

Um Projeto √© uma pasta no computador que re√∫ne todos os arquivos necess√°rios para realizar uma an√°lise de dados.

A principal raz√£o para a utiliza√ß√£o dos Projetos √© a **organiza√ß√£o**. Com eles, √© muito mais f√°cil importar bases de dados para dentro do `R`, criar an√°lises reprodut√≠veis e compartilhar o trabalho com outras pessoas.

<br>

<div style="text-align: center;">
  <strong style="font-size: 150%;">Habitue-se, desde cedo, a criar um projeto para cada nova an√°lise.</strong>
</div>

<br>

Para **criar um projeto**, clique em `New Project` no menu `File`. Na janela que se abrir, escolha `New Directory` para criar o projeto em uma nova pasta, ou `Existing Directory` para usar uma pasta que j√° existe.

Ao criar um projeto, o `RStudio` cria um arquivo `nome-do-projeto.Rproj` na pasta escolhida. Esse arquivo guarda as configura√ß√µes do projeto e pode ser usado para abrir o `RStudio` diretamente nele.

.footnote[Com o `Git` instalado, pode usar projetos para conectar com reposit√≥rios remotos e versionar o c√≥digo ([GitHub](https://github.com], por exemplo). Para isso, basta clicar em `Version Control`. Para maiores informa√ß√µes, acesse o [Zen do R](https://blog.curso-r.com/posts/2019-07-23-zen-do-r-4/) e o <i>workshop</i> [Introdu√ß√£o a utiliza√ß√£o do Git e Github no RStudio](https://www.youtube.com/watch?v=uQL6NOSd9cc) da [Beatriz Milz](https://twitter.com/BeaMilz).]

---

### Projetos

**Criando um novo Projeto:**

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("img/20-criar-projeto.gif")
```

---

### Projetos

**RStudio com um Projeto aberto:**

```{r, echo=FALSE, out.width="70%", fig.align='center'}
knitr::include_graphics("img/21-exemplo-projeto-aberto.png")
```

---

### Projetos

**Navegando entre os Projetos:**

```{r, echo=FALSE, out.width="70%", fig.align='center'}
knitr::include_graphics("img/22-exemplo-lista-projetos.png")
```

---

### Pacote: `tidyverse`

√â uma cole√ß√£o de pacotes de `R` desenvolvidos para a Ci√™ncia de Dados. 

Os pacotes do `tidyverse` compartilham uma mesma filosofia de desenvolvimento, sintaxe e estruturas de dados. 

Embora o `tidyverse` instale diversos outros pacotes, apenas esses s√£o carrregados: 

<br>


|     **Pacote**    |                      **Fun√ß√£o**                      |
|:-----------------:|:----------------------------------------------------:|
|      `tibble`     |               _data frames_ repaginados              |
|      `readr`      | leitura e importa√ß√£o de dados (e.g. `.csv` e `.txt`) |
| `tidyr` e `dplyr` |           arruma√ß√£o e manipula√ß√£o de dados           |
|     `stringr`     |                  trabalha com textos                 |
|     `forcats`     |                 trabalha com fatores                 |
|      `purrr`      |                 programa√ß√£o funcional                |
|     `ggplot2`     |           visualiza√ß√£o de dados (gr√°ficos)           |

---

class: inverse center middle
name: importacao

# Importa√ß√£o de dados

.center[(Acompanhe no arquivo `02-importacao.R`)]

---

### Caminhos

√â importante na tarefa de **importa√ß√£o de dados** saber onde est√° o arquivo que se quer importar. Toda fun√ß√£o de importa√ß√£o vai exigir um **caminho** (uma _string_) que representa o endere√ßo do arquivo no computador.

<br>

----

**Diret√≥rio de trabalho (_working directory_):**

√â a pasta em que o **R** vai procurar os arquivos na hora de ler as informa√ß√µes ou gravar os arquivos na hora de salvar os objetos.

Se est√° dentro de um Projeto, o diret√≥rio de trabalho ser√°, por padr√£o, a pasta raiz do Projeto (√© a pasta que cont√©m o arquivo `.Rproj`).

Se n√£o estiver usando um Projeto ou n√£o souber qual √© o diret√≥rio de trabalho, √© poss√≠vel descobri-lo usando a fun√ß√£o `getwd()`. Ela vai devolver uma _string_ com o caminho do diret√≥rio de trabalho.

A fun√ß√£o `setwd()` pode ser utilizada para mudar o diret√≥rio de trabalho. Como argumento, ela recebe o caminho para o novo diret√≥rio.

---

### Caminhos

**Caminhos absolutos:**

S√£o aqueles que t√™m in√≠cio na pasta raiz do computador/usu√°rio. Por exemplo: `/Users/luisagisele/Repositorio/workshop-r`.

**Caminhos absolutos** s√£o uma **m√° pr√°tica**. Se voc√™ trocar de computador ou passar o _script_ para outra pessoa, o c√≥digo n√£o vai funcionar. Isso ocorre porque o caminho absoluto de um arquivo, muito provavelmente, ser√° diferente entre os computadores.

<br>

----

**Caminhos relativos:**

S√£o aqueles que t√™m in√≠cio no diret√≥rio de trabalho da sess√£o. Usando o exemplo de caminho absoluto acima, o caminho relativo √©: `workshop-r`.

O uso de **caminhos relativos** dentro de um projeto √© considerado uma **boa pr√°tica**, pois quando a pasta do projeto for compartilhado com algu√©m, todos os caminhos existentes no c√≥digo continuar√£o funcionando em qualquer computador.

---

## Tibbles

S√£o uma evolu√ß√£o da classe `data.frame`.

As fun√ß√µes do **`tidyverse`** para importa√ß√£o, arruma√ß√£o e manipula√ß√£o de bases devolvem sempre `tibbles` em vez de `data.frames`.

Embora existam outras diferen√ßas entre as classes, a mais importante √© a forma como a tabela √© mostrada no _console_.

Quanto a isso, as diferen√ßas s√£o:

- `tibbles` mostram o n√∫mero de linhas, o n√∫mero de colunas e a classe das vari√°veis;

- `tibbles` mostram apenas as 10 primeiras linhas;

- `tibbles` mostram o n√∫mero de colunas que couber na tela do _console_.

- `tibbles` n√£o nomeiam linhas (`row.names`).

---

### Tibbles

**Exemplo: base `mtcars` como `data.frame`**

```{r, echo=FALSE}
head(mtcars, n = 15)
```

---

### Tibbles

**Exemplo: base `mtcars` como `tibble`**

```{r}
tibble::as_tibble(mtcars)
```

**Perceba que a coluna com os nomes dos modelos dos ve√≠culos desaparece na `tibble`.** Isso acontece porque, no `data.frame`, esses nomes fazem parte dos **nomes das linhas (`row.names`)**, e n√£o de uma coluna propriamente dita. J√° nas `tibbles`, os nomes das linhas **n√£o s√£o exibidos nem armazenados da mesma forma**, o que pode dar a impress√£o de que a "coluna" foi exclu√≠da.

---

### Tibbles

**Exemplo: base `mtcars` como `tibble`**

Uma maneira de **preservar os nomes dos modelos dos ve√≠culos** como coluna ao converter um `data.frame` em `tibble` √© utilizar o argumento `rownames = "nome_da_coluna"` dentro da fun√ß√£o `as_tibble()`. Assim, a nova `tibble` ter√° **12 colunas** ‚Äî uma a mais que a anterior, pois agora os nomes dos modelos passam a fazer da base como uma vari√°vel expl√≠cita.

```{r}
tibble::as_tibble(mtcars, rownames = "cars")
```

---

### [Cheat Sheets](https://posit.co/resources/cheatsheets/) 

[![Cheat Sheets](img/23-cheatsheet-readr.png)](https://rstudio.github.io/cheatsheets/data-import.pdf)

---

### Importa√ß√£o de arquivos

- Pacote [`readr`](https://readr.tidyverse.org): utilizados para ler arquivos de texto

  - `read_csv()`: l√™ arquivos `.csv` (valores separados por v√≠rgula)
  
  - `read_csv2()`: l√™ arquivos `.csv` (valores separados por ponto e v√≠rgula)
  
  - `read_delim()`: l√™ arquivos `.txt` (valores separados por tabula√ß√£o)
  
  - `read_rds()`: l√™ arquivos `.rds` (formato nativo do R)

- Pacote [`readxl`](https://readxl.tidyverse.org): utilizado para ler arquivos do Excel

  - `read_excel()`: l√™ arquivos `.xls` e `.xlsx`
  
- Pacote [`haven`](https://haven.tidyverse.org): utilizado para ler arquivos do SPSS, Stata e SAS

  - `read_sas()`: l√™ arquivos `.sas7bdat`
  
  - `read_spss()`: l√™ arquivos `.sav`
  
  - `read_dta()`: l√™ arquivos `.dta`
  
  - `read_stata()`: l√™ arquivos `.dta`
  
---

### Importa√ß√£o de arquivos

Para ler arquivos de texto (`.csv` ou `.txt`), s√£o utilizadas fun√ß√µes do pacote [`readr`](https://readr.tidyverse.org).

Como exemplo, vamos utilizar a base dos Pinguins, originalmente disponibilizado no pacote [`palmerpenguins`](https://allisonhorst.github.io/palmerpenguins/), que cont√©m dados sobre pinguins da Ant√°rtica. 

Essa base tamb√©m pode ser encontrado traduzido para o portugu√™s no pacote [`dados`](https://cienciadedatos.github.io/dados/).

Vamos importar essa base para o **R** lendo o arquivo `pinguins.csv` que est√° dentro da para `dados`. Para isso, utilizamos a fun√ß√£o `read_csv()` do pacote `readr`. 

Se o arquivo estiver bem formatado, a fun√ß√£o s√≥ precisar√° do caminho at√© o arquivo para funcionar.

```{r}
library(readr) # carrega o pacote respons√°vel pela importa√ß√£o

pinguins_csv <- read_csv("dados/pinguins.csv")
```

---

### Importa√ß√£o de arquivos

O objeto resultante ser√° um `tibble`:

```{r}
pinguins_csv
```

---

### Importa√ß√£o de arquivos

Em alguns pa√≠ses, como o Brasil, as v√≠rgulas s√£o utilizadas para separar as casas decimais dos n√∫meros, inviabilizando os arquivos `.csv`.

Nesse caso, os arquivos s√£o separados por ponto-e-v√≠rgula (;). Para ler essas bases no **R**, basta usar a fun√ß√£o `read_csv2()` do pacote [`readr`](https://readr.tidyverse.org).

```{r}
library(readr) # carrega o pacote respons√°vel pela importa√ß√£o

pinguins_csv2 <- read_csv2("dados/pinguins2.csv")
```

<br>

----

Arquivos `.txt` podem ser lidos com a fun√ß√£o `read_delim()`. Nesse caso, al√©m do caminho at√© o arquivo, √© preciso indicar qual √© o caractere utilizado para separar as colunas da base.

Um arquivo separado por tabula√ß√£o, por exemplo, pode ser lido utilizando o argumento `delim = "\t"`. O c√≥digo `\t` √© uma forma textual de representar a tecla `TAB`.

```{r}
library(readr) # carrega o pacote respons√°vel pela importa√ß√£o

pinguins_txt <- read_delim("dados/pinguins.txt", delim = "\t")
```

---

### Importa√ß√£o de arquivos

**Arquivos direto da Internet:** 

√â poss√≠vel importar dados diretamente da internet. Para isso, basta colocar o _link_ do arquivo/tabela entre aspas no caminho do arquivo.

```{r eval = FALSE, include = TRUE}
titanic <- read_csv(
  "https://raw.githubusercontent.com/beatrizmilz/2020-R-Ladies-SP-Basico/master/docs/data/titanic.csv"
)
```

<br>

----

**Arquivos Excel:** 

Para ler planilhas do Excel (arquivos `.xlsx` ou `.xls`) utilizamos a fun√ß√£o `read_excel()` do pacote [`readxl`](https://readxl.tidyverse.org). 

Como esse pacote n√£o faz parte do `tidyverse`, √© necess√°rio instal√°-lo separadamente. 

```{r eval = FALSE, include = TRUE}
library(readxl) # carrega o pacote

readxl::pinguins_xlsx <- read_excel("dados/pinguins.xlsx")
```

---

### Importa√ß√£o de arquivos

**Arquivos Excel: argumentos √∫teis**

Planilhas do Excel s√£o facilmente edit√°veis ‚Äî e por isso, √© comum recebermos bases de dados **desconfiguradas**, ou seja, em um formato que o **R** n√£o consegue importar diretamente.

Para evitar ter que arrumar "na m√£o", correndo o risco de cometer erros ou alterar dados sem querer, a fun√ß√£o `read_excel()` oferece argumentos que ajudam a importar a base corretamente.

Principais argumentos:

- `sheet =`: indica qual aba da planilha deve ser importada.  _(Padr√£o: primeira aba)_

- `col_names =`: define se a primeira linha cont√©m os nomes das colunas.  _(Padr√£o: `TRUE`)_

- `col_types =`: especifica o tipo de dado de cada coluna (ex: `"text"`, `"numeric"` etc).  _(Padr√£o: `"guess"`)_

- `skip =`: pula um n√∫mero definido de linhas antes da leitura.  _(Padr√£o: `0`)_

- `n_max =`: define quantas linhas devem ser lidas.  _(Padr√£o: `Inf`)_

- `NA =`: indica quais valores devem ser interpretados como `NA`.  _(Padr√£o: `""`)_

---

### Exporta√ß√£o de arquivos

Exportar objetos do **R** significa gravar as bases (ou objetos) em um arquivo no disco r√≠gido (HD) do computador.

De forma geral, para cada fun√ß√£o `read_*()` usada na importa√ß√£o, existe uma fun√ß√£o correspondente `write_*()` para exporta√ß√£o.

Essas fun√ß√µes s√£o simples: voc√™ precisa informar **o objeto que deseja salvar** e o **caminho com o nome do arquivo** (incluindo a extens√£o!).

```{r eval = FALSE, include = TRUE}
library(readr)  # fun√ß√µes write_csv, write_csv2, write_delim

# CSV com v√≠rgula
write_csv(pinguins, "dados/pinguins.csv")
# CSV com ponto-e-v√≠rgula (mais comum em PT-BR)
write_csv2(pinguins, "dados/pinguins2.csv")

# Arquivo TXT com tabula√ß√£o
write_delim(pinguins, "dados/pinguins.txt", delim = "\t")
```

Para salvar arquivos em formato **Excel** `.xlsx`, usamos a fun√ß√£o `write_xlsx()` do pacote [`writexl`](https://writexl.tidyverse.org), que precisa ser carregado separadamente.

```{r eval = FALSE, include = TRUE}
library(writexl) # carrega o pacote

write_xlsx(pinguins, "dados/pinguins.xlsx")
```

---

### Importa√ß√£o e exporta√ß√£o de arquivos

**Extens√£o `.rds`**

A extens√£o `.rds` representa uma estrutura bin√°ria de arquivo nativa do R.  
Ela pode ser usada para salvar **qualquer objeto** ‚Äî n√£o apenas data frames ou tibbles ‚Äî no disco r√≠gido (HD).

Quando aplicada a conjuntos de dados, essa estrutura bin√°ria permite **compacta√ß√£o**, gerando arquivos significativamente menores em compara√ß√£o com formatos como `.csv`.

Para criar e ler arquivos `.rds`, utilizamos as fun√ß√µes `write_rds()` e `read_rds()`, ambas do pacote [`readr`](https://readr.tidyverse.org).

```{r eval = FALSE, include = TRUE}
library(readr)  # pacote necess√°rio

# escrevendo SEM compacta√ß√£o
write_rds(pinguins, "dados/pinguins.rds")

# escrevendo COM compacta√ß√£o
write_rds(pinguins, "dados/pinguins.rds", compress = "gz")

# lendo a base diretamente
read_rds("dados/pinguins.rds")

# importando para um objeto
pinguins_rds <- read_rds("dados/pinguins.rds")
```

---
  
### Visualiza√ß√£o de um objeto
  
**Para visualizar um objeto em aba separada:**

√â poss√≠vel visualizar os dados (ou parte deles) de forma mais confort√°vel clicando no nome do objeto no painel `Global Environment` (aba `Environment`) do RStudio.

Outra op√ß√£o √© usar a fun√ß√£o `View(nome_da_base)` diretamente:

```{r eval = FALSE, include = TRUE}
View(pinguins_csv)
```

Isso abrir√° o conte√∫do do objeto em uma nova aba, com apar√™ncia de planilha.

```{r echo=FALSE, out.width="100%", fig.align='center'}
knitr::include_graphics("img/24-view-pinguins.png")
```

---

### Visualiza√ß√£o de um objeto

**Para visualizar uma base no _Console_:**

√â poss√≠vel "espiar" os dados de uma forma r√°pida usando a fun√ß√£o `glimpse()` do pacote [`dplyr`](https://dplyr.tidyverse.org). 

Essa fun√ß√£o mostra: 

- o n√∫mero de observa√ß√µes (linhas) e vari√°veis (colunas), 
- os nomes e tipos das colunas, 
- e alguns valores iniciais de cada vari√°vel.

```{r}
library(dplyr)  # carrega o pacote necess√°rio

glimpse(pinguins_csv)
```

---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

A <span style='color:#34a15a'><b>Base dos Dados</b></span> √© uma organiza√ß√£o n√£o governamental, sem fins lucrativos e <span style='color:#34a15a'><b>open source</b></span>, que atua para universalizar o acesso a <span style='color:#34a15a'><b>dados p√∫blicos de qualidade</b></span>.

Em seu reposit√≥rio, voc√™ encontra <span style='color:#34a15a'><b>dados brasileiros j√° tratados, limpos e padronizados</b></span>, prontos para serem importados diretamente para o **R** por meio do pacote [`basedosdados`](https://basedosdados.org/blog/como-acessar-dados-publicos-em-r).

Al√©m disso, os respons√°veis pela <span style='color:#34a15a'><b>Base dos Dados</b></span> mant√™m um reposit√≥rio com os c√≥digos das an√°lises que publicam em _workshops_, redes sociais, artigos e tutoriais.

[![GitHub da Base dos Dados](img/25-base-dos-dados-github.png)](https://github.com/basedosdados/analises)

---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

√â poss√≠vel realizar o _download_ de arquivos `.csv` completos diretamente pelo site.

Entretanto, esse tipo de acesso <span style='color:#34a15a'><b>n√£o est√° dispon√≠vel para arquivos muito grandes</b></span>.

----

Para esses casos, utiliza-se o <span style='color:#34a15a'><font size='5'><b>BigQuery:</b></font></span>

Um servi√ßo de banco de dados em nuvem da Google, que permite realizar consultar em linguagem `SQL` diretamente do navegador, com:

- <span style='color:#34a15a'><b>Rapidez:</b></span> mesmo _queries_ complexas s√£o processadas em poucos minutos;

- <span style='color:#34a15a'><b>Escalabilidade:</b></span> o BigQuery se ajusta automaticamente, podendo lidar com volumes gigantescos (at√© <span style='color:#34a15a'><b>exabytes</b></span>, se necess√°rio);

- <span style='color:#34a15a'><b>Economia:</b></span> todo usu√°rio tem direito a <span style='color:#34a15a'><b>1 TB gratuito por m√™s</b></span> em consultas.

<br>

<div style="text-align: center;">
  <strong style="font-size: 130%; color: #34a15a;">
    O uso do BigQuery √© gratuito at√© 1 TB/m√™s. Acima disso, h√° cobran√ßa por volume de dados processados.
  </strong>
</div>

---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

<span style='color:#34a15a'><b>Como criar um projeto no BigQuery:</b></span>

Para criar um Projeto no _Google Cloud_, basta ter uma conta de e-mail do Google.

Mesmo que voc√™ pretenda carregar dados pr√≥prios, √© necess√°rio criar um Projeto (mesmo vazio) para poder executar _queries_ no _datalake_ p√∫blico da <span style='color:#34a15a'>Base dos Dados</span>.

1. [Acesse o Google Cloud](https://console.cloud.google.com/projectselector2/home/dashboard). Se for sua primeira vez, aceite os Termos de Servi√ßo.

2. Clique em `Create Project` / `Criar Projeto` e escolha um nome bacana para o projeto.

3. Confirme em `Create` / `Criar`.

Para mais detalhes, consulte a [documenta√ß√£o oficial](https://cloud.google.com/bigquery/docs/sandbox/?hl=pt).

.footnote[
<span style='color:#34a15a'><b>Por que √© preciso criar um projeto no Google Cloud?</b></span>
A Google oferece <span style='color:#34a15a'><b>1 TB gratuito por m√™s</b></span> de uso do BigQuery <span style='color:#34a15a'><b>para cada projeto</b></span>. Voc√™ <span style='color:#34a15a'><b>n√£o precisa cadastrar cart√£o de cr√©dito</b></span> ‚Äî o BigQuery inicia automaticamente no modo _Sandbox_, que permite usar os recursos <span style='color:#34a15a'><b>sem configurar forma de pagamento</b></span>.
]

---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

<span style='color:#34a15a'><b>Como criar um projeto no BigQuery</b></span>

<span style='color:#34a15a'><b>Habilitar o projeto no R:</b></span>

```r
install.packages("basedosdados")  # instala o pacote

library(basedosdados)  # carrega o pacote

# identifique o projeto sempre que iniciar uma nova sess√£o no R
set_billing_id("id-do-projeto")
```

Na primeira vez que acessar o _Google Cloud_ pelo **R**, uma p√°gina do Google ser√° aberta solicitando a autoriza√ß√£o para vincular sua conta ao pacote [`basedosdados`](https://basedosdados.org/blog/como-acessar-dados-publicos-em-r).

----

No canal da [Base dos Dados](https://www.youtube.com/@BasedosDados) no Youtube, h√° um _Workshop_ ensinando a acessar os dados p√∫blicos em **R**: [acesse aqui](https://www.youtube.com/watch?v=M9ayiseIjvI).

No blog da [Base dos Dados](https://dev.to/basedosdados), h√° um tutorial de como usar a biblioteca [`basedosdados`](https://basedosdados.org/blog/como-acessar-dados-publicos-em-r) no **R**: [acesse aqui](https://dev.to/basedosdados/como-usar-a-biblioteca-basedosdados-no-r-capitulo-1-46kb).


---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

<span style='color:#34a15a'><b>Como criar um projeto no BigQuery</b></span>

```{r echo=FALSE, out.width="85%", fig.align='center'}
knitr::include_graphics("img/26-big-query-projeto-r.gif")
```

---

### <span style='color:#34a15a'>BASE DOS DADOS</span>

<span style='color:#34a15a'><b>Como fixar o projeto da Base dos Dados (BD) no seu BigQuery:</b></span>

```{r echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("img/27-fixa-bd-no-bigquery.gif")
```

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

**SQL** (_Structured Query Language_, ou _Linguagem de Consulta Estruturada_) √© a linguagem padr√£o para **consultas em bancos de dados relacionais**.

Ela permite selecionar, filtrar, agrupar e combinar dados de forma declarativa ‚Äî ou seja, dizendo o que voc√™ quer, e n√£o como fazer.

----

<span style='color:#34a15a'><b>Principais cl√°usulas (palavras-chave):</b></span>

  - **SELECT**: seleciona as colunas desejadas (√© o comando principal do SQL)  

  - **FROM**: especifica a tabela de onde os dados ser√£o extra√≠dos  

  - **WHERE**: define condi√ß√µes (filtros) para os dados selecionados  

  - **GROUP BY**: agrupa os dados com base em uma ou mais colunas  

  - **HAVING**: filtra os grupos criados pelo `GROUP BY`  

  - **ORDER BY**: ordena os dados com base em uma ou mais colunas  

  - **DISTINCT**: remove valores duplicados da sele√ß√£o  

  - **UNION**: combina os resultados de duas consultas SQL em uma s√≥ tabela

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

<span style='color:#34a15a'><b>Palavras-chave ‚Äì Operadores L√≥gicos:</b></span>

- **AND**: retorna verdadeiro se **todas as condi√ß√µes** forem verdadeiras  

- **OR**: retorna verdadeiro se **pelo menos uma condi√ß√£o** for verdadeira  

- **NOT**: inverte o resultado l√≥gico da condi√ß√£o (retorna o oposto)

----

<span style='color:#34a15a'><b>Palavras-chave ‚Äì Fun√ß√µes de Agrega√ß√£o:</b></span>

- **AVG**: calcula a m√©dia dos valores em um campo  

- **COUNT**: retorna o n√∫mero de registros selecionados  

- **SUM**: soma os valores de um campo  

- **MAX**: retorna o maior valor em um campo  

- **MIN**: retorna o menor valor em um campo  

- **STDDEV**: calcula o desvio padr√£o dos valores  

- **VARIANCE**: calcula a vari√¢ncia dos valores

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

<span style='color:#34a15a'><b>Palavras-chave ‚Äì Operadores relacionais:</b></span>

- **<** (_MENOR_): seleciona registros com valores **menores do que** a condi√ß√£o especificada  

- **>** (_MAIOR_): seleciona registros com valores **maiores do que** a condi√ß√£o especificada  

- **<=** (_MENOR OU IGUAL_): seleciona registros com valores **menores ou iguais a** determinada condi√ß√£o  

- **>=** (_MAIOR OU IGUAL_): seleciona registros com valores **maiores ou iguais a** determinada condi√ß√£o  

- **=** (_IGUAL_): seleciona registros com valores **iguais a** determinada condi√ß√£o  

- **<>** (_DIFERENTE_): seleciona registros com valores **diferentes de** determinada condi√ß√£o

<br>

- **BETWEEN**: seleciona registros com valores **dentro de um intervalo fechado** (inclui os limites)  

- **LIKE**: seleciona registros que **correspondem a um padr√£o de texto**  

- **IN**: seleciona registros cujo valor **est√° presente em uma lista definida**

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

<div class="panelset">

<div class="panel">
<div class="panel-name">Ex. Fict√≠cio</div>

```{sql eval = FALSE, include = TRUE}
-- consulta sem filtro

SELECT coluna1, coluna2, coluna3,
       coluna4 AS apelido_da_coluna
FROM `tabela`
```

Imagine que a base seja muito grande e voc√™ n√£o ir√° utilizar todos os dados.

√â recomendado <span style='color:#34a15a'><b>filtrar</b></span> os dados ainda na consulta, antes de import√°-los para o **R**.

```{sql eval = FALSE, include = TRUE}
-- consulta com filtro

SELECT coluna1, coluna2, coluna3,
       coluna4 AS apelido_da_coluna
FROM `tabela`
WHERE coluna1 = valor AND coluna2 = valor
```

</div>

<div class="panel">
<div class="panel-name">Ex. Real (sem filtro)</div>

```{sql eval = FALSE, include = TRUE}
-- Consulta selecionando colunas espec√≠ficas

SELECT id_municipio, nome_regiao
FROM `basedosdados.br_bd_diretorios_brasil.municipio`
```

<br>

Para selecionar <span style='color:#34a15a'><b>todas as colunas</b></span> de uma tabela, use `*` ap√≥s o `SELECT`.

``` {sql eval = FALSE, include = TRUE}
-- Consulta selecionando todas as colunas

SELECT *
FROM `basedosdados.br_bd_diretorios_brasil.municipio`
```

</div>

<div class="panel">
<div class="panel-name">Ex. Real (com filtro)</div>

```{sql eval = FALSE, include = TRUE}
-- M√©dia da taxa de aprova√ß√£o e IDEB por munic√≠pio e ensino

SELECT id_municipio, ano,
       AVG(taxa_aprovacao) AS tx_aprov,
       ensino,
       AVG(ideb) AS ideb
FROM `basedosdados.br_inep_ideb.municipio`
WHERE ano = 2021
GROUP BY id_municipio, ano, ensino
```

</div>

<div class="panel">
<div class="panel-name">Ex. com JOIN</div>

```{sql eval = FALSE, include = TRUE}
-- Jun√ß√£o entre PIB e popula√ß√£o por munic√≠pio

SELECT pib.id_municipio, pib.ano,
       pop.id_municipio, pop.populacao
FROM `basedosdados.br_ibge_pib.municipio` AS pib
LEFT JOIN `basedosdados.br_ibge_populacao.municipio` AS pop
ON pib.id_municipio = pop.id_municipio
```

<br>

<span style='color:#34a15a'><b>Palavras-Chave:</b></span>

- **AS:** define um "apelido" para a coluna e/ou para a tabela

- **LEFT JOIN:** une duas tabelas em uma mesma base de dados

- **ON:** define a "chave" que liga as duas tabelas

</div>

</div>

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

```{r echo=FALSE, out.width="90%", fig.align='center'}
knitr::include_graphics("img/28-ex-download-bigquery-r.gif")
```

---

### <span style='color:#34a15a'>BASE DOS DADOS ‚Äî SQL</span>

Para que o **R** consiga importar os dados da consulta `SQL`, √© necess√°rio utilizar a fun√ß√£o `read_sql()` do pacote [`basedosdados`](https://basedosdados.org/blog/como-acessar-dados-publicos-em-r) ao final da _query_.

Existem duas formas de fazer isso:

<span style='color:#34a15a'><b>1. Criando um objeto intermedi√°rio com a consulta `SQL` e, depois, o objeto final com os dados:</b></span>

```{r eval=FALSE, include=TRUE}
library(basedosdados) # pacote necess√°rio

obj_intermediario <- "SELECT id_municipio, nome_regiao
FROM `basedosdados.br_bd_diretorios_brasil.municipio`"

base_final <- basedosdados::read_sql(obj_intermediario)
```


<span style='color:#34a15a'><b>2. Utilizando o operador `pipe` (`%>%` ou `|>`) para encadear a consulta diretamente √† fun√ß√£o `read_sql()`:</b></span>

```{r eval=FALSE, include=TRUE}
library(basedosdados) # pacote necess√°rio

base_final <- "SELECT id_municipio, nome_regiao
FROM `basedosdados.br_bd_diretorios_brasil.municipio`" |> 
  read_sql()
```

---

class: inverse center middle
name: manipulacao

# Manipula√ß√£o de dados

.center[(Acompanhe no arquivo `04-manipulacao.R`)]

---

### Pipe: `%>%` ou `|>`

- `CTRL` + `SHIFT` + `M`: cria o `%>%` &nbsp; (ou `|>`).

Pense no operador `pipe` como uma forma de **escrever uma receita de bolo**:

```{r, eval = FALSE, include = TRUE}
esfrie(
  asse(
    coloque(
      bata(
        acrescente(
          recipiente(rep("farinha", 2), "√°gua", 
                     "fermento", "leite", "√≥leo"), 
          "farinha", at√© = "macio"), 
        dura√ß√£o = "3min"), 
      lugar = "forma", tipo = "grande", 
      untada = TRUE), dura√ß√£o = "50min"), 
  "geladeira", "20min")
```

Aqui, precisamos ler **de dentro para fora**: o primeiro comando executado √© `recipiente()`, mas o primeiro que aparece √© `esfrie()` ‚Äî justamente o √∫ltimo a ser feito. Confuso, n√©?

Agora veja como a mesma receita √© escrita usando o operador `|>`:


.footnote[Para MacOs, use `CMD` + `SHIFT` + `M` para inserir o pipe `|>`.]

---

### Pipe: `%>%` ou `|>`

- `CTRL` + `SHIFT` + `M`: cria o `%>%` &nbsp; (ou `|>`).

Veja como a **mesma receita** fica muito mais clara com o uso do `|>`:

```{r, eval = FALSE, include = TRUE}
recipiente(rep("farinha", 2), "√°gua", "fermento", "leite", "√≥leo") %>%
  acrescente("farinha", at√© = "macio") %>%
  bata(dura√ß√£o = "3min") %>%
  coloque(lugar = "forma", tipo = "grande", untada = TRUE) %>%
  asse(dura√ß√£o = "50min") %>%
  esfrie("geladeira", "20min")
```

Agora a leitura do c√≥digo segue **de cima para baixo**, como uma lista de etapas ‚Äî exatamente como uma receita de verdade!

<div style="text-align: center;">
  <strong style="font-size: 110%;">O operador <code>|></code> passa o resultado da opera√ß√£o √† esquerda como primeiro argumento da fun√ß√£o √† direita. Isso torna o c√≥digo mais limpo, encadeado e f√°cil de entender.</strong>
</div>

.footnote[
O `%>%` vem do pacote `{magrittr}` e funciona como o `|>`, mas com algumas diferen√ßas. Ainda √© muito usado em pacotes como o `{dplyr}`. Quer saber mais? D√° uma olhada:  [magrittr: Ceci n‚Äôest pas un pipe](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html)  [R 4.1: novidades e o pipe nativo `|>`](https://www.jumpingrivers.com/blog/new-features-r410-pipe-anonymous-functions/)
]

---

Os exemplos apresentados aqui ser√£o das base abaixo:

```{r}
library(tidyverse)

pinguins <- read_csv("dados/pinguins.csv")
pinguins_raw <- read_csv("dados/pinguins_raw.csv")
```

----

```{r echo=FALSE}
head(pinguins, n = 3)
```

```{r echo=FALSE}
head(pinguins_raw, n = 3)
```

---

### Pacote &nbsp; `dplyr`

O `{dplyr}` √© um dos **pacotes mais importantes** para a **manipula√ß√£o de dados** no R. Ele oferece fun√ß√µes simples e poderosas para transformar linhas e colunas de uma base de dados.

As principais fun√ß√µes s√£o:

- `filter()`: filtra linhas com base em uma condi√ß√£o

- `select()`: seleciona colunas espec√≠ficas

- `arrange()`: ordena as linhas com base em uma ou mais colunas

- `mutate()`: cria ou modifica colunas

- `group_by()`: agrupa os dados por uma ou mais vari√°veis

- `summarise()`: resumo os dados (ex: m√©dia, mediana, soma, etc.)

- `left_join()`: junta duas tabelas com base em uma chave comum

Essas fun√ß√µes seguem um padr√£o simples:

  - Sempre recebem uma `tibble` como primeiro argumento;
  - Sempre retornam uma `tibble` como resultado.
  
---

### [Cheat Sheets](https://posit.co/resources/cheatsheets/) 

[![Cheat Sheets](img/29-cheatsheet-dplyr.png)](https://rstudio.github.io/cheatsheets/data-transformation.pdf)

---

### Selecionando Colunas:  &nbsp; `select()`

A fun√ß√£o `select()` √© usada para escolher colunas espec√≠ficas de uma base de dados.

- O **primeiro argumento** √© o nome da base (ex: `pinguins`)

- Os **demais argumentos** s√£o os nomes das colunas que voc√™ quer manter

_N√£o √© necess√°rio usar aspas para os nomes das colunas!_

```{r}
select(pinguins, species)
```

---

### Selecionando Colunas:  &nbsp; `select()`

Voc√™ tamb√©m pode selecionar **v√°rias colunas ao mesmo tempo**, separando os nomes por v√≠rgulas:

```{r}
select(pinguins, species, sex, body_mass_g)
```

Esse exemplo retorna apenas as colunas `species`, `sex` e `body_mass_g` da base `pinguins`.

---

### Selecionando Colunas:  &nbsp; `select()`

O operador `:` √© √∫til para selecionar **colunas consecutivas** ‚Äî ou seja, de uma coluna at√© outra, seguindo a ordem da base:

```{r}
select(pinguins, island:body_mass_g)
```

Esse c√≥digo seleciona todas as colunas de `island` at√© `body_mass_g`, na ordem em que aparecem na base.

---

### Selecionando Colunas:  &nbsp; `select()`

O `{dplyr}` oferece algumas **fun√ß√µes auxiliares** muito √∫teis para selecionar colunas com base em partes do nome:

- `starts_with("texto")`: seleciona colunas que **come√ßam** com o texto especificado

- `ends_with("texto")`: seleciona colunas que **terminam** com o texto especificado

- `contains("texto")`: seleciona colunas que **cont√™m** o texto especificado

```{r}
select(pinguins, ends_with("mm"))
```

---

### Selecionando Colunas:  &nbsp; `select()`

Voc√™ pode **remover colunas** usando o sinal de menos (`‚Äî`) antes do nome da coluna:

```{r}
select(pinguins, -year)
```

Esse c√≥digo retorna todas as colunas da base `pinguins`, exceto a coluna `year`.

---

### Selecionando Colunas:  &nbsp; `select()`

Para remover **mais de uma coluna**, basta usar o sinal de menos (`‚Äî`) junto com a fun√ß√£o `c()`:

```{r}
select(pinguins, -c(year, sex))
```

Esse c√≥digo retorna todas as colunas da base `pinguins`, exceto as colunas `year` e `sex`.

---

### Ordenando linhas: &nbsp; `arrange()`

A fun√ß√£o `arrange()` serve para **ordenar as linhas** da base de dados.

- O **primeiro argumento** √© a base (ex: `pinguins`)

- Os **demais argumentos** s√£o as colunas usadas como crit√©rio de ordena√ß√£o.

Por padr√£o, a ordena√ß√£o √© feita em ordem **crescente**.

```{r}
arrange(pinguins, body_mass_g)
```

---

### Ordenando linhas: &nbsp; `arrange()`

Para ordenar de forma **descrescente**, basta usar a fun√ß√£o `desc()` dentro do `arrange()`.

No exemplo abaixo, os pinguins s√£o organizados da **maior para a menor massa corporal**:

```{r}
arrange(pinguins, desc(body_mass_g))
```

---

### Ordenando linhas: &nbsp; `arrange()`

Voc√™ tamb√©m pode ordenar por **duas ou mais colunas** ao mesmo tempo.

No exemplo abaixo, as linhas s√£o ordenadas:

- **Primeiro** pelo **comprimento do bico** (`bill_length_mm`), em **ordem descrescente**

- **Depois**, em caso de empate, pela **profundidade do bico** (`bill_depth_mm`), em **ordem crescente**.

```{r}
arrange(pinguins, desc(bill_length_mm), bill_depth_mm)
```

---

### Aplicando mais de uma fun√ß√£o

Em muitos casos, queremos aplicar **v√°rias transforma√ß√µes** em sequ√™ncia em uma base de dados.

Por exemplo, imagine que voc√™ quer uma tabela com a **esp√©cie** dos pinguins e a **massa corporal**, ordenada em ordem crescente:

```{r eval=FALSE}
arrange(select(pinguins, species, body_mass_g), body_mass_g)
```

Esse c√≥digo funciona, mas fica um pouco dif√≠cil de ler ‚Äî precisamos interpretar **de dentro para fora**.

A solu√ß√£o para tornar esse tipo de opera√ß√£o mais clara √© usar o operador **pipe** (`|>`):

```{r eval=FALSE}
pinguins |> 
  select(species, body_mass_g) |>
  arrange(body_mass_g)
```

O que est√° acontecendo aqui?

- Na **segunda linha**, aplicamos a fun√ß√£o `select()` na base `pinguins`

- Na **terceira linha**, aplicamos a fun√ß√£o `arrange()` na sa√≠da da fun√ß√£o `select()`.

O c√≥digo fica mais **intuitivo**, com as opera√ß√µes organizadas em sequ√™ncia l√≥gica.

---

### Filtrando linhas: &nbsp; `filter()`

A fun√ß√£o `filter()` √© usada para **selecionar linhas** que atendem a uma determinada condi√ß√£o.

No exemplo abaixo, s√£o filtradas apenas as observa√ß√µes em que o **comprimento da nadadeira** (`flipper_length_mm`) √© **maior que 140 mm**:

```{r}
filter(pinguins, flipper_length_mm > 140)
```

---

### Filtrando linhas: &nbsp; `filter()`

Voc√™ pode combinar `select()` e `filter()` para trabalhar apenas com as **colunas e linhas de interesse**.

No exemplo abaixo:

- Primeiro, selecionamos as colunas `species` e `flipper_length_mm`

- Depois, filtramos apenas os pinguins com **nadadeiras maiores que 140 mm**.

```{r}
pinguins |> 
  select(species, flipper_length_mm) |>
  filter(flipper_length_mm > 140)
```

---

### Filtrando linhas: &nbsp; `filter()`

Voc√™ pode aplicar **dois ou mais filtros** ao mesmo tempo, separando as condi√ß√µes por v√≠rgula dentro do `filter()`.

No exemplo abaixo, o c√≥digo retorna apenas os pinguins que:

- Est√£o na ilha de **Torgersen**

- T√™m **profundidade de bico maior que 15 mm**.

```{r}
pinguins |> 
  filter(island == "Torgersen", bill_depth_mm > 15)
```

---

### Filtrando linhas: &nbsp; `filter()`

Voc√™ tamb√©m pode fazer **opera√ß√µes diretamente dentro do `filter()`**, comparando os valores das colunas com c√°lculos feitos na hora.

No exemplo abaixo, o c√≥digo retorna apenas os pinguins cuja **massa corporal** √© **maior que a m√©dia da base**:

```{r}
pinguins |> 
  filter(body_mass_g > mean(body_mass_g, na.rm = TRUE))
```

O argumento `na.rm = TRUE` serve para ignorar valores ausentes (`NA`) no c√°lculo da m√©dia.

---

### Criando novas colunas: &nbsp; `mutate()`

A fun√ß√£o `mutate()` √© usada para:

- **Criar uma nova coluna**

- Ou **modificar uma coluna existente**

No exemplo abaixo, os valores da coluna `bill_length_mm` s√£o divididos por 10, convertendo a unidade de **mil√≠metros (mm)** para **cent√≠metros (cm)**:

```{r}
pinguins |> 
  mutate(bill_length_mm = bill_length_mm / 10)
```

---

### Criando novas colunas: &nbsp; `mutate()`

Voc√™ tamb√©m pode usar `mutate()` para **criar uma nova coluna**, mantendo a vari√°vel original intacta.

No exemplo abaixo, √© criada a coluna `bill_length_cm`, que converte o comprimento do bico de **mil√≠metros para cent√≠metros**:

```{r}
pinguins |> 
  mutate(bill_length_cm = bill_length_mm / 10)
```

A nova coluna ser√° adicionada **no final da tabela**.

---

### Criando novas colunas: &nbsp; `mutate()`

Com `mutate()`, voc√™ tamb√©m pode realizar **qualquer opera√ß√£o** com uma ou mais colunas.

A √∫nica regra √© que o resultado de cada opera√ß√£o:

- tenha **o mesmo n√∫mero de linhas** da base original

- ou **um √∫nico valor** (que ser√° repetido em todas as linhas)

Tamb√©m √© poss√≠vel **criar ou modificar v√°rias colunas ao mesmo tempo** dentro de um mesmo `mutate()`.

```{r}
pinguins |> 
  mutate(mean_bill_length_mm = mean(bill_length_mm, na.rm = TRUE),
         country = "Antarctica") |> 
  select(species, island, bill_length_mm, mean_bill_length_mm, country)
```

---

### Sumarizando colunas: &nbsp; `summarise()`

A **sumariza√ß√£o** √© uma forma de **resumir um conjunto de dados** usando alguma medida de interesse.

Exemplos comuns incluem: m√©dia, mediana, vari√¢ncia, contagem, propor√ß√£o etc.

Essas m√©tricas ajudam a entender melhor o comportamento de uma vari√°vel.

O exemplo abaixo calcula a **m√©dia da massa corporal** dos pinguins:


```{r}
pinguins |> 
  summarise(mean_body_mass_g = mean(body_mass_g, na.rm = TRUE))
```

.footnote[Tamb√©m pode ser usado a fun√ß√£o `summarize()` ‚Äî ambas as formas funcionam.]

---

### Sumarizando colunas: &nbsp; `summarise()`

Voc√™ pode calcular **v√°rias estat√≠sticas ao mesmo tempo** dentro de um √∫nico `summarise()`.

Cada m√©trica calculada se transforma em uma **coluna da nova base**:

```{r}
pinguins |> 
  summarise(
    mean_flipper_length_mm = mean(flipper_length_mm, na.rm = TRUE),
    median_flipper_length_mm = median(flipper_length_mm, na.rm = TRUE),
    dp_flipper_length_mm = sd(flipper_length_mm, na.rm = TRUE)
  )
```

.footnote[Tamb√©m pode ser usado a fun√ß√£o `summarize()` ‚Äî ambas as formas funcionam.]

---

### Sumarizando colunas: &nbsp; `summarise()`

Voc√™ tamb√©m pode calcular **resumos de colunas diferentes** dentro de um mesmo `summarise()`.

```{r}
pinguins |>  
  summarise(
    mean_flipper_length_mm = mean(flipper_length_mm, na.rm = TRUE),
    mean_bill_length_mm = mean(bill_length_mm, na.rm = TRUE),
    median_bill_depth_mm = median(bill_depth_mm, na.rm = TRUE)
  )
```

Neste exemplo, calculamos a **m√©dia ou mediana** de diferentes vari√°veis num√©ricas da base.

.footnote[Tamb√©m pode ser usado a fun√ß√£o `summarize()` ‚Äî ambas as formas funcionam.]

---

### Sumarizando colunas agrupadas: &nbsp; `group_by()`

A fun√ß√£o `group_by()` **n√£o altera os dados da base**, mas indica que as opera√ß√µes seguintes devem ser feitas **por grupo**.

No exemplo abaixo, a base `pinguins` √© agrupada pela coluna `island`:

```{r}
pinguins |> 
  group_by(island)
```

<!-- .footnote[Essa marca√ß√£o s√≥ tem efeito real quando combinada com fun√ß√µes como `summarise()`.] -->

---

### Sumarizando colunas agrupadas: &nbsp; `group_by()`

Voc√™ tamb√©m pode agrupar por **mais de uma vari√°vel ao mesmo tempo**.

```{r}
pinguins |> 
  group_by(island, species)
```

Neste caso, os dados s√£o agrupados **por combina√ß√£o de `island` e `species`** ‚Äî ou seja, cada grupo representa uma esp√©cie dentro de uma determinada ilha.

<!-- .footnote[Essa marca√ß√£o s√≥ tem efeito real quando combinada com fun√ß√µes como `summarise()`.] -->

---

### Sumarizando colunas agrupadas

Em muitos casos, queremos **resumir uma vari√°vel num√©rica** para **cada categoria** de uma outra coluna.

Para isso, usamos `summarise()` em conjunto com `group_by()`.

No exemplo abaixo, o c√≥digo calcula a **m√©dia da massa corporal** (`body_mass_g`) para cada ilha (`island`):

```{r}
pinguins |> 
  group_by(island) |> 
  summarise(mean_body_mass_g = mean(body_mass_g, na.rm = TRUE)) |> 
  arrange(desc(mean_body_mass_g))
```

Ou seja, **agrupamos os dados por ilha**, **calculamos a m√©dia da massa corporal em cada grupo** e, por fim, **ordenamos do maior para o menor valor**.

.footnote[Tamb√©m pode ser usado a fun√ß√£o `summarize()` ‚Äî ambas as formas funcionam.]

---

### Ordenando colunas:  &nbsp;  `relocate()`

A fun√ß√£o `relocate()` permite **mudar a ordem das colunas** de uma base, colocando-as em outra posi√ß√£o ‚Äî seja com base no nome ou na posi√ß√£o de outra coluna.

Voc√™ pode usar o argumento `.after` para **colocar uma ou mais colunas logo ap√≥s** uma coluna de refer√™ncia:

```{r}
pinguins |> 
  relocate(sex, year, .after = island)
```

No exemplo abaixo, as colunas `sex` e `year` foram movidas para **aparecer logo ap√≥s** a coluna `island`.

---

### Ordenando colunas:  &nbsp;  `relocate()`

Da mesma forma, √© poss√≠vel usar o argumento `.before` para **mover colunas para antes** de outra coluna espec√≠fica:

```{r}
pinguins |> 
  relocate(sex, year, .before = island)
```

Nesse exemplo, as colunas `species` e `island` foram movidas para **aparecer logo antes** da coluna `island`.

---

### Renomeando colunas: &nbsp; `rename()`

A fun√ß√£o `rename()` serve para **alterar os nomes das colunas** de uma base de dados.

- O **primeiro argumento** √© o **novo nome** desejado

- O **segundo argumento** √© o **nome atual** da coluna

```{r}
pinguins |>  
  rename(
    comprimento_bico_mm = bill_length_mm,
    profundidade_bico_mm = bill_depth_mm,
    comprimento_nadadeira_mm = flipper_length_mm,
    massa_corporal_g = body_mass_g
  )
```

---

### Selecionando linhas: &nbsp; `slice_head()`

A fun√ß√£o `slice_head()` √© usada para **extrair as primeiras linhas** de uma tabela, de forma controlada.

Ela √© √∫til quando queremos visualizar apenas o in√≠cio de uma base ou analisar os primeiros registros de cada grupo (quando combinada com `group_by()`).

- O argumento `n = ` define **quantas linhas ser√£o retornadas**.

```{r}
pinguins |> 
  slice_head(n = 8)
```

Neste exemplo, s√£o retornadas as **8 primeiras linhas** da base `pinguins`.

---

### Selecionando linhas: &nbsp; `slice_tail()`

A fun√ß√£o `slice_tail()` √© usada para **extrair as √∫ltimas linhas** de uma tabela.

Ela funciona de forma semelhante ao `slice_head()`, mas retorna os **√∫ltimos registros** em vez dos primeiros.

- O argumento `n = ` define **quantas linhas ser√£o retornadas**.

```{r}
pinguins |>  
  slice_tail(n = 5)
```

Neste exemplo, s√£o retornada s as **5 √∫ltimas linhas** da base `pinguins`.

---

### Selecionando linhas: &nbsp; `slice_max()`

A fun√ß√£o `slice_max()` seleciona as **linhas com os maiores valores** de uma coluna num√©rica espec√≠fica.

- O argumento `n = ` define **quantas linhas ser√£o retornadas**.

- Se `n` n√£o for informado, retorna **apenas a linha com o maior valor**.

- Em caso de empate, o n√∫mero de linhas retornadas pode ser **maior que `n`**.

```{r}
pinguins |> 
  slice_max(bill_depth_mm, n = 5)
```

Neste exemplo, s√£o retornadas as **5 linhas com maior profundidade de bico** (`bill_depth_mm`) da base `pinguins`.

---

### Selecionando linhas: &nbsp; `slice_min()`

A fun√ß√£o `slice_min()` seleciona as **linhas com os menores valores** de uma coluna num√©rica espec√≠fica.

- O argumento `n = ` define **quantas linhas ser√£o retornadas**.

- Se `n` n√£o for informado, retorna **apenas a linha com o menor valor**.

- Em caso de empate, o n√∫mero de linhas retornadas pode ser **maior que `n`**.

```{r}
pinguins |> 
  slice_min(flipper_length_mm, n = 5)
```

Neste exemplo, s√£o retornadas as **5 linhas com menor comprimento de nadadeira** (`flipper_length_mm`) da base `pinguins`.

---

### Selecionando linhas: &nbsp; `slice_sample()`

A fun√ß√£o `slice_sample()` √© usada para **selecionar linhas aleatoriamente** de uma base.

- O argumento `n = ` define **quantas linhas ser√£o sorteadas e retornadas**.

- √â √∫til para criar **amostras aleat√≥rias** simples, testes ou visualiza√ß√µes r√°pidas.

```{r}
pinguins |> 
  slice_sample(n = 12)
```

Neste exemplo, s√£o retornadas **12 linhas aleat√≥rias** da base `pinguins`.

---

### Limpando a tabela: &nbsp; `distinct()`

A fun√ß√£o `distinct()` remove **linhas duplicadas**, considerando os valores de um ou mais colunas.

- Por padr√£o, retorna **apenas as colunas informadas**

- Com `.keep_all = TRUE`, mant√©m **todas as colunas** da base original.

```{r}
pinguins |> 
  distinct(body_mass_g, .keep_all = TRUE)
```

Neste exemplo, a base retorna **apenas uma linha para cada valor distinto de `body_mass_g`**, mantendo as demais colunas associadas √† primeira ocorr√™ncia de cada valor.

---

### Contando valores: &nbsp; `count()`

A fun√ß√£o `count()` √© usada para **contar a frequ√™ncia de valores** de cada categoria em uma coluna ‚Äî especialmente √∫til para vari√°veis categ√≥ricas.

.pull-left[
```{r}
pinguins |> 
  count(species)
```

Nesse exemplo, o c√≥digo retorna **quantas observa√ß√µes existem para cada esp√©cie** de pinguim na base de dados.
]

.pull-right[
```{r}
pinguins |> 
  count(species, island)
```

Neste exemplo, o c√≥digo retorna a **quantidade de pinguins por esp√©cie em cada ilha**, ou seja, uma contagem para cada combina√ß√£o de `species` e `island`.
]

---

### Combinando dados: &nbsp; `bind_rows()`

A fun√ß√£o `bind_rows()` serve para **juntar objetos pela linha** ‚Äî ou seja, ela empilha os dados, mesmo que tenham colunas diferentes.

- O argumento `.id =` cria uma nova coluna que indica a origem de cada linha (√∫til para identificar de onde veio cada peda√ßo da base).

<!-- Neste exemplo, as tabelas s√£o unidas **por linha**, e a coluna `id` identifica se a linha veio de `pinguins_01` ou `pinguins_02`. -->


```{r}
# seleciona algumas linhas e colunas de duas partes da base
pinguins_01 <- slice(pinguins, 1:5) |> select(1:3)
pinguins_02 <- slice(pinguins, 51:55) |> select(4:6)
# junta as linhas das duas tabelas
bind_rows(pinguins_01, pinguins_02, .id = "id")
```

---

### Combinando dados: &nbsp; `bind_cols()`

A fun√ß√£o `bind_cols()` √© usada para **juntar objetos lado a lado**, ou seja, **por colunas**.

- As bases precisam ter o **mesmo n√∫mero de linhas**
- O argumento `.name_repair = "unique"` garante que, se houver colunas com nomes repetidos, elas sejam renomeadas automaticamente

```{r}
# seleciona 5 linhas diferentes da base original
pinguins_01 <- slice(pinguins, 1:5)
pinguins_02 <- slice(pinguins, 51:55)
# junta as colunas das duas tabelas
bind_cols(pinguins_01, pinguins_02, .name_repair = "unique")
```

<!-- Neste exemplo, os dados s√£o combinados **horizontalmente**, formando uma nova tabela com mais colunas. -->

---

### Unindo bases: &nbsp; `*_join()`

Combina pares de bases de dados **com base em uma ou mais chaves** ‚Äî colunas em comum entre elas.

.left-column[

<br>
<br>
<br>
```{r echo=FALSE, out.width="90%"}
knitr::include_graphics("img/30-joins.png")
```

]

.right-column[

**Jun√ß√µes de muta√ß√£o**

Adicionam informa√ß√µes de uma base √† outra:

- `left_join(x, y)`: mant√©m todas as observa√ß√µes em **x**
- `right_join(x, y)`: mant√©m todas as observa√ß√µes em **y**
- `inner_join(x, y)`: mant√©m apenas as observa√ß√µes **com correspond√™ncia em x e y**
- `full_join(x, y)`: mant√©m **todas** as observa√ß√µes em x e em y

**Jun√ß√µes de filtragem**

Selecionam linhas de x com base na exist√™ncia de correspond√™ncia em y:

- `semi_join(x, y)`: mant√©m as observa√ß√µes de **x que t√™m correspond√™ncia em y**
- `anti_join(x, y)`: mant√©m as observa√ß√µes de **x que n√£o t√™m correspond√™ncia em y**

]

---

### Unindo bases: &nbsp; `*_join()`

.pull-left[

```{r echo=FALSE, out.width="70%"}
knitr::include_graphics("img/31-left-join.gif")
```


```{r echo=FALSE, out.width="70%"}
knitr::include_graphics("img/32-inner-join.gif")
```

]

.pull-right[

```{r echo=FALSE, out.width="70%"}
knitr::include_graphics("img/33-right-join.gif")
```


```{r echo=FALSE, out.width="70%"}
knitr::include_graphics("img/34-full-join.gif")
```

]

---

### Unindo bases: &nbsp; `*_join()` ‚Äî Exemplo

Vamos criar uma nova tabela com **as coordenadas geogr√°ficas das ilhas** e, em seguida, fazer a **jun√ß√£o** com a base `pinguins`.

<div class="panelset">
<div class="panel">
<div class="panel-name">1. Criando a base auxiliar</div>

```{r}
# Coordenadas geogr√°ficas das ilhas
pinguins_ilhas <- tibble(
  ilha = c("Torgersen", "Biscoe", "Dream", "Alpha"),
  longitude = c(-64.083333, -63.775636, -64.233333, -63),
  latitude = c(-64.766667, -64.818569, -64.733333, -64.316667)
)

pinguins_ilhas
```

</div>

<div class="panel">
<div class="panel-name">2. Unindo as bases ‚Äî <code>left_join()</code></div>

Agora, usamos `left_join()` para **adicionar as colunas de latitude e longitude** √† base `pinguins`, com base no nome da ilha.

```{r}
pinguins_left_join <- left_join(pinguins, pinguins_ilhas, by = c("island" = "ilha"))
glimpse(pinguins_left_join)
```

<!-- A base resultante cont√©m todas as colunas originais da `pinguins` $+$ as coordenadas geogr√°ficas da ilha correspondente. -->

</div>
</div>

---

### Opera√ß√µes de conjuntos e compara√ß√µes de dados

.pull-left[

<br>
<br>

<!-- <center> -->
  <b><font size = 6>Opera√ß√µes para comparar dos dados:</font></b>
<!-- </center> -->

- **`union(x, y)`**: retorna todas as linhas que est√£o em **x**, **y** ou em ambos

- **`interesect(x, y)`**: retorna apenas as linhas que est√£o em **x** _e_ em **y**

- **`setdiff(x, y)`**: retorna as linhas que est√£o em **x**, mas **n√£o** em **y**

- **`setequal(x, y)`**: verifica se **x** e **y** s√£o iguais (independentemente da ordem)

]

.pull-right[
<br>
<br>
```{r echo=FALSE, out.width="85%"}
knitr::include_graphics("img/35-operacoes.png")
```

]

---

### Pacote &nbsp; `tidyr`

**O que s√£o dados organizados (_tidy data_)?**

```{r echo=FALSE, out.width="85%", fig.align='center'}
knitr::include_graphics("img/36-tidy-data.png")
```

Dados organizados seguem uma **estrutura padr√£o**, que facilita a an√°lise e a manipula√ß√£o dos dados. Em um conjunto de dados _tidy_:

- Cada **coluna** representa uma **vari√°vel**

- Cada **linha** representa uma **observa√ß√£o**

- Cada **c√©lula** cont√©m **um √∫nico valor**

---

### Pacote &nbsp; `tidyr`

O pacote `{tidyr}` √© respons√°vel por **organizar os dados no formato _tidy_**, deixando-os mais f√°ceis de trabalhar.

<br>

Principais fun√ß√µes:

- `unite()`: junta o conte√∫do de v√°rias colunas em uma s√≥

- `separate()`: divide o conte√∫do de uma coluna em v√°rias

- `separate_rows()`: divide em v√°rias colunas e linhas

- `drop_na()`: remove linhas com valores ausentes (`NA`)

- `replace_na()`: substitui valores ausentes (`NA`) por outro valor espec√≠fico

- `pivot_wider()`: transforma dados do formato longo para o formato largo

- `pivot_longer()`: transforma dados do formato largo para o formato longo

---

### [Cheat Sheets](https://posit.co/resources/cheatsheets/) 

[![Cheat Sheets](img/37-cheatsheet-tidyr.png)](https://rstudio.github.io/cheatsheets/tidyr.pdf)

---

### Uni√£o de colunas: &nbsp; `unite()`

A fun√ß√£o `unite()` combina o conte√∫do de duas ou mais colunas em uma **√∫nica coluna de texto**.

No exemplo abaixo, as colunas `species` e `island` s√£o unidas em uma nova coluna chamada `species_island`, separadas por um caractere de sublinhado (`-`).

```{r}
especie_ilha_unido <- pinguins |> 
  unite(
    col = "especie_ilha",     # novo nome da coluna
    species:island,           # colunas a serem unidas
    sep = " - "               # separador entre os valores
  )

head(especie_ilha_unido)
```

---

### Separa√ß√£o de colunas: &nbsp; `separate()`

A fun√ß√£o `separate()` divide o conte√∫do de uma coluna em **duas ou mais colunas**, com base em um separador.

No exemplo abaixo, a coluna `especie_ilha` √© separada em duas colunas: `especie` e `ilha`, usando `" - "` como separador:

```{r}
especie_ilha_separado <- especie_ilha_unido |> 
  separate(
    col = especie_ilha,             # coluna a ser separada
    into = c("especie", "ilha"),    # nomes das novas colunas
    sep = " - "                     # separador utilizado
  )

head(especie_ilha_separado)
```

---

### Remove NAs: &nbsp; `drop_na()`

A fun√ß√£o `drop_na()` remove todas as **linhas que cont√™m valores ausentes (`NA`)**. 

<div class="panelset">
<div class="panel">
<div class="panel-name">Removendo em <b>todas as colunas</b></div>

Por padr√£o, ela verifica **todas as colunas** da base:

```{r}
pinguins |> 
  drop_na() # remove em todas as colunas
```

</div>

<div class="panel">
<div class="panel-name">Removendo em <b>colunas espec√≠ficas</b></div>

Tamb√©m pode especificar **quais colunas** deseja considerar ao remover os `NAs`:

```{r}
pinguins |> 
  drop_na(sex) # remove apenas quando `sex` estiver ausente
```

</div>
</div>

---

### Pivotar os dados: &nbsp; `pivot_*()`

.pull-left[

**`pivot_longer()`**

Transforma os dados em formato **mais longo**, ou seja, com **mais linhas** e **menos colunas**.

√â √∫til para organizar bases que foram estruturadas para entrada ou visualiza√ß√£o, e n√£o para an√°lise ‚Äî algo comum em planilhas.

<br>

**`pivot_wider()`**

Transforma os dados em formato **mais largo**, ou seja, com **mais colunas** e **menos linhas**.

Apesar de menos comum em dados _tidy_, √© √∫til para criar **tabelas resumo** ou preparar dados para ferramentas espec√≠ficas.

]

.pull-right[

```{r echo=FALSE, out.width="100%", fig.align='center'}
knitr::include_graphics("img/38-original-dfs-tidy.png")
```

]

---

### Larga para longa: &nbsp; `pivot_longer()`

Transforma um banco de dados **do farmato largo para o formato longo** ‚Äî ou seja, o n√∫mero de **linhas aumenta** e o n√∫mero de **colunas diminui**. Os principais argumentos da fun√ß√£o `pivot_longer()` s√£o:

- `cols`: colunas que ser√£o _"derretidas"_ em uma √∫nica coluna
- `names_to`: nome da nova coluna que ir√° conter os **nomes originais das colunas** (vari√°veis)
- `values_to`: nome da nova coluna que ir√° conter os **valores das colunas originais** (vari√°veis)

.tiny[
```{r}
pivot_longer(data = pinguins_raw[, c(2, 3, 10:13)], 
             cols = `Culmen Length (mm)`:`Body Mass (g)`, 
             names_to = "medidas", 
             values_to = "valores")
```
]

---

### Longa para larga: &nbsp; `pivot_wider()`

Transforma um banco de dados **do formato longo para o formato largo** ‚Äî ou seja, o n√∫mero de **colunas aumenta** e o n√∫mero de **linhas diminui**. Os principais argumentos da fun√ß√£o `pivot_wider()` s√£o:

- `names_from`: vari√°vel categ√≥rica que ir√° formar os **nomes das novas colunas**
- `values_from`: vari√°vel que ir√° preencher os **valores das novas colunas**
- `values_fill`: _(opcional)_ valor a ser usado para preencher os `NAs`, quando n√£o houver correspond√™ncia

```{r}
pivot_wider(data = pinguins_raw[, c(2, 3, 13)], 
            names_from = Species, 
            values_from = `Body Mass (g)`)
```

